import{E as yt,V as C,h as ae,i as Me,Q as Ye,j as ft,k as I,d as pe,l as An,m as Et,n as Te,F as He,C as Y,o as tn,p as Rn,D as Ln,a as be,s as ce,q as ue,r as Pe,t as vn,I as Pn,N as Cn,u as nn,v as In,w as On,x as kn,y as sn,z as Dn,A as Nn,G as dt,J as on,K as Fn,T as rn,O as Un,U as jn,X as Hn,Y as qe,Z as ke,_ as Ne,c as ze,$ as _t,a0 as Gn,b as we,a1 as Bn,M as ve,a2 as Vn,a3 as an,a4 as We,L as Kn,a5 as zn,a6 as Xe,a7 as Fe,P as Xn,a8 as xt,a9 as Yn,aa as Ot,ab as qn,ac as Wn,ad as Zn,ae as Qn,af as cn,ag as $n,ah as Jn,ai as kt,aj as es,ak as ts,al as ln,am as ns,an as ss,ao as is,ap as os,aq as rs,ar as te,as as un,at as hn,au as fn,av as dn,aw as pn,ax as Ze,ay as pt,az as mt,aA as as,aB as cs,R as ls,aC as us,aD as hs,aE as fs,aF as ds,aG as ps,aH as ms,aI as gs,aJ as bs,aK as Ts,aL as ws,aM as ys}from"./three.module.e25001cb.js";const Dt={type:"change"},tt={type:"start"},Nt={type:"end"};class Es extends yt{constructor(t,n){super();n===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ae.ROTATE,MIDDLE:ae.DOLLY,RIGHT:ae.PAN},this.touches={ONE:Me.ROTATE,TWO:Me.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(p){p.addEventListener("keydown",Lt),this._domElementKeyEvents=p},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(Dt),e.update(),i=s.NONE},this.update=function(){const p=new C,S=new Ye().setFromUnitVectors(t.up,new C(0,1,0)),B=S.clone().invert(),V=new C,$=new Ye,xe=2*Math.PI;return function(){const It=e.object.position;p.copy(It).sub(e.target),p.applyQuaternion(S),a.setFromVector3(p),e.autoRotate&&i===s.NONE&&F(R()),e.enableDamping?(a.theta+=c.theta*e.dampingFactor,a.phi+=c.phi*e.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let ie=e.minAzimuthAngle,oe=e.maxAzimuthAngle;return isFinite(ie)&&isFinite(oe)&&(ie<-Math.PI?ie+=xe:ie>Math.PI&&(ie-=xe),oe<-Math.PI?oe+=xe:oe>Math.PI&&(oe-=xe),ie<=oe?a.theta=Math.max(ie,Math.min(oe,a.theta)):a.theta=a.theta>(ie+oe)/2?Math.max(ie,a.theta):Math.min(oe,a.theta)),a.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(e.minDistance,Math.min(e.maxDistance,a.radius)),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),p.setFromSpherical(a),p.applyQuaternion(B),It.copy(e.target).add(p),e.object.lookAt(e.target),e.enableDamping===!0?(c.theta*=1-e.dampingFactor,c.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(c.set(0,0,0),h.set(0,0,0)),l=1,u||V.distanceToSquared(e.object.position)>r||8*(1-$.dot(e.object.quaternion))>r?(e.dispatchEvent(Dt),V.copy(e.object.position),$.copy(e.object.quaternion),u=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",vt),e.domElement.removeEventListener("pointerdown",ee),e.domElement.removeEventListener("pointercancel",Be),e.domElement.removeEventListener("wheel",Rt),e.domElement.removeEventListener("pointermove",_e),e.domElement.removeEventListener("pointerup",Ce),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",Lt)};const e=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=s.NONE;const r=1e-6,a=new ft,c=new ft;let l=1;const h=new C;let u=!1;const d=new I,f=new I,m=new I,b=new I,T=new I,w=new I,x=new I,E=new I,A=new I,y=[],_={};function R(){return 2*Math.PI/60/60*e.autoRotateSpeed}function P(){return Math.pow(.95,e.zoomSpeed)}function F(p){c.theta-=p}function L(p){c.phi-=p}const D=function(){const p=new C;return function(B,V){p.setFromMatrixColumn(V,0),p.multiplyScalar(-B),h.add(p)}}(),z=function(){const p=new C;return function(B,V){e.screenSpacePanning===!0?p.setFromMatrixColumn(V,1):(p.setFromMatrixColumn(V,0),p.crossVectors(e.object.up,p)),p.multiplyScalar(B),h.add(p)}}(),N=function(){const p=new C;return function(B,V){const $=e.domElement;if(e.object.isPerspectiveCamera){const xe=e.object.position;p.copy(xe).sub(e.target);let Ve=p.length();Ve*=Math.tan(e.object.fov/2*Math.PI/180),D(2*B*Ve/$.clientHeight,e.object.matrix),z(2*V*Ve/$.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(D(B*(e.object.right-e.object.left)/e.object.zoom/$.clientWidth,e.object.matrix),z(V*(e.object.top-e.object.bottom)/e.object.zoom/$.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function X(p){e.object.isPerspectiveCamera?l/=p:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*p)),e.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function K(p){e.object.isPerspectiveCamera?l*=p:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/p)),e.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function se(p){d.set(p.clientX,p.clientY)}function he(p){x.set(p.clientX,p.clientY)}function U(p){b.set(p.clientX,p.clientY)}function J(p){f.set(p.clientX,p.clientY),m.subVectors(f,d).multiplyScalar(e.rotateSpeed);const S=e.domElement;F(2*Math.PI*m.x/S.clientHeight),L(2*Math.PI*m.y/S.clientHeight),d.copy(f),e.update()}function ye(p){E.set(p.clientX,p.clientY),A.subVectors(E,x),A.y>0?X(P()):A.y<0&&K(P()),x.copy(E),e.update()}function Ee(p){T.set(p.clientX,p.clientY),w.subVectors(T,b).multiplyScalar(e.panSpeed),N(w.x,w.y),b.copy(T),e.update()}function q(p){p.deltaY<0?K(P()):p.deltaY>0&&X(P()),e.update()}function fe(p){let S=!1;switch(p.code){case e.keys.UP:N(0,e.keyPanSpeed),S=!0;break;case e.keys.BOTTOM:N(0,-e.keyPanSpeed),S=!0;break;case e.keys.LEFT:N(e.keyPanSpeed,0),S=!0;break;case e.keys.RIGHT:N(-e.keyPanSpeed,0),S=!0;break}S&&(p.preventDefault(),e.update())}function de(){if(y.length===1)d.set(y[0].pageX,y[0].pageY);else{const p=.5*(y[0].pageX+y[1].pageX),S=.5*(y[0].pageY+y[1].pageY);d.set(p,S)}}function j(){if(y.length===1)b.set(y[0].pageX,y[0].pageY);else{const p=.5*(y[0].pageX+y[1].pageX),S=.5*(y[0].pageY+y[1].pageY);b.set(p,S)}}function W(){const p=y[0].pageX-y[1].pageX,S=y[0].pageY-y[1].pageY,B=Math.sqrt(p*p+S*S);x.set(0,B)}function g(){e.enableZoom&&W(),e.enablePan&&j()}function M(){e.enableZoom&&W(),e.enableRotate&&de()}function O(p){if(y.length==1)f.set(p.pageX,p.pageY);else{const B=et(p),V=.5*(p.pageX+B.x),$=.5*(p.pageY+B.y);f.set(V,$)}m.subVectors(f,d).multiplyScalar(e.rotateSpeed);const S=e.domElement;F(2*Math.PI*m.x/S.clientHeight),L(2*Math.PI*m.y/S.clientHeight),d.copy(f)}function k(p){if(y.length===1)T.set(p.pageX,p.pageY);else{const S=et(p),B=.5*(p.pageX+S.x),V=.5*(p.pageY+S.y);T.set(B,V)}w.subVectors(T,b).multiplyScalar(e.panSpeed),N(w.x,w.y),b.copy(T)}function H(p){const S=et(p),B=p.pageX-S.x,V=p.pageY-S.y,$=Math.sqrt(B*B+V*V);E.set(0,$),A.set(0,Math.pow(E.y/x.y,e.zoomSpeed)),X(A.y),x.copy(E)}function G(p){e.enableZoom&&H(p),e.enablePan&&k(p)}function Q(p){e.enableZoom&&H(p),e.enableRotate&&O(p)}function ee(p){e.enabled!==!1&&(y.length===0&&(e.domElement.setPointerCapture(p.pointerId),e.domElement.addEventListener("pointermove",_e),e.domElement.addEventListener("pointerup",Ce)),Sn(p),p.pointerType==="touch"?xn(p):$e(p))}function _e(p){e.enabled!==!1&&(p.pointerType==="touch"?Mn(p):Je(p))}function Ce(p){Pt(p),y.length===0&&(e.domElement.releasePointerCapture(p.pointerId),e.domElement.removeEventListener("pointermove",_e),e.domElement.removeEventListener("pointerup",Ce)),e.dispatchEvent(Nt),i=s.NONE}function Be(p){Pt(p)}function $e(p){let S;switch(p.button){case 0:S=e.mouseButtons.LEFT;break;case 1:S=e.mouseButtons.MIDDLE;break;case 2:S=e.mouseButtons.RIGHT;break;default:S=-1}switch(S){case ae.DOLLY:if(e.enableZoom===!1)return;he(p),i=s.DOLLY;break;case ae.ROTATE:if(p.ctrlKey||p.metaKey||p.shiftKey){if(e.enablePan===!1)return;U(p),i=s.PAN}else{if(e.enableRotate===!1)return;se(p),i=s.ROTATE}break;case ae.PAN:if(p.ctrlKey||p.metaKey||p.shiftKey){if(e.enableRotate===!1)return;se(p),i=s.ROTATE}else{if(e.enablePan===!1)return;U(p),i=s.PAN}break;default:i=s.NONE}i!==s.NONE&&e.dispatchEvent(tt)}function Je(p){if(e.enabled!==!1)switch(i){case s.ROTATE:if(e.enableRotate===!1)return;J(p);break;case s.DOLLY:if(e.enableZoom===!1)return;ye(p);break;case s.PAN:if(e.enablePan===!1)return;Ee(p);break}}function Rt(p){e.enabled===!1||e.enableZoom===!1||i!==s.NONE||(p.preventDefault(),e.dispatchEvent(tt),q(p),e.dispatchEvent(Nt))}function Lt(p){e.enabled===!1||e.enablePan===!1||fe(p)}function xn(p){switch(Ct(p),y.length){case 1:switch(e.touches.ONE){case Me.ROTATE:if(e.enableRotate===!1)return;de(),i=s.TOUCH_ROTATE;break;case Me.PAN:if(e.enablePan===!1)return;j(),i=s.TOUCH_PAN;break;default:i=s.NONE}break;case 2:switch(e.touches.TWO){case Me.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;g(),i=s.TOUCH_DOLLY_PAN;break;case Me.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;M(),i=s.TOUCH_DOLLY_ROTATE;break;default:i=s.NONE}break;default:i=s.NONE}i!==s.NONE&&e.dispatchEvent(tt)}function Mn(p){switch(Ct(p),i){case s.TOUCH_ROTATE:if(e.enableRotate===!1)return;O(p),e.update();break;case s.TOUCH_PAN:if(e.enablePan===!1)return;k(p),e.update();break;case s.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;G(p),e.update();break;case s.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Q(p),e.update();break;default:i=s.NONE}}function vt(p){e.enabled!==!1&&p.preventDefault()}function Sn(p){y.push(p)}function Pt(p){delete _[p.pointerId];for(let S=0;S<y.length;S++)if(y[S].pointerId==p.pointerId){y.splice(S,1);return}}function Ct(p){let S=_[p.pointerId];S===void 0&&(S=new I,_[p.pointerId]=S),S.set(p.pageX,p.pageY)}function et(p){const S=p.pointerId===y[0].pointerId?y[1]:y[0];return _[S.pointerId]}e.domElement.addEventListener("contextmenu",vt),e.domElement.addEventListener("pointerdown",ee),e.domElement.addEventListener("pointercancel",Be),e.domElement.addEventListener("wheel",Rt,{passive:!1}),this.update()}}const Ft=new C,nt=new ft,st=new C;class Hi{constructor(t,n){n===void 0&&(console.warn('THREE.FirstPersonControls: The second parameter "domElement" is now mandatory.'),n=document),this.object=t,this.domElement=n,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let e=0,s=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onMouseDown=function(u){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(u.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0;break}this.mouseDragOn=!0},this.onMouseUp=function(u){if(this.activeLook)switch(u.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1;break}this.mouseDragOn=!1},this.onMouseMove=function(u){this.domElement===document?(this.mouseX=u.pageX-this.viewHalfX,this.mouseY=u.pageY-this.viewHalfY):(this.mouseX=u.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=u.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(u){switch(u.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0;break}},this.onKeyUp=function(u){switch(u.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1;break}},this.lookAt=function(u,d,f){return u.isVector3?st.copy(u):st.set(u,d,f),this.object.lookAt(st),h(this),this},this.update=function(){const u=new C;return function(f){if(this.enabled===!1)return;if(this.heightSpeed){const y=pe.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=f*(y*this.heightCoef)}else this.autoSpeedFactor=0;const m=f*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(m+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(m),this.moveLeft&&this.object.translateX(-m),this.moveRight&&this.object.translateX(m),this.moveUp&&this.object.translateY(m),this.moveDown&&this.object.translateY(-m);let b=f*this.lookSpeed;this.activeLook||(b=0);let T=1;this.constrainVertical&&(T=Math.PI/(this.verticalMax-this.verticalMin)),s-=this.mouseX*b,this.lookVertical&&(e-=this.mouseY*b*T),e=Math.max(-85,Math.min(85,e));let w=pe.degToRad(90-e);const x=pe.degToRad(s);this.constrainVertical&&(w=pe.mapLinear(w,0,Math.PI,this.verticalMin,this.verticalMax));const E=this.object.position;u.setFromSphericalCoords(1,w,x).add(E),this.object.lookAt(u)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",Ut),this.domElement.removeEventListener("mousedown",r),this.domElement.removeEventListener("mousemove",i),this.domElement.removeEventListener("mouseup",a),window.removeEventListener("keydown",c),window.removeEventListener("keyup",l)};const i=this.onMouseMove.bind(this),r=this.onMouseDown.bind(this),a=this.onMouseUp.bind(this),c=this.onKeyDown.bind(this),l=this.onKeyUp.bind(this);this.domElement.addEventListener("contextmenu",Ut),this.domElement.addEventListener("mousemove",i),this.domElement.addEventListener("mousedown",r),this.domElement.addEventListener("mouseup",a),window.addEventListener("keydown",c),window.addEventListener("keyup",l);function h(u){const d=u.object.quaternion;Ft.set(0,0,-1).applyQuaternion(d),nt.setFromVector3(Ft),e=90-pe.radToDeg(nt.phi),s=pe.radToDeg(nt.theta)}this.handleResize(),h(this)}}function Ut(o){o.preventDefault()}const it={type:"change"},ot={type:"start"},rt={type:"end"};class Gi extends yt{constructor(t,n){super();n===void 0&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');const e=this,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:ae.ROTATE,MIDDLE:ae.DOLLY,RIGHT:ae.PAN},this.target=new C;const i=1e-6,r=new C;let a=1,c=s.NONE,l=s.NONE,h=0,u=0,d=0;const f=new C,m=new I,b=new I,T=new C,w=new I,x=new I,E=new I,A=new I,y=[],_={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const g=e.domElement.getBoundingClientRect(),M=e.domElement.ownerDocument.documentElement;e.screen.left=g.left+window.pageXOffset-M.clientLeft,e.screen.top=g.top+window.pageYOffset-M.clientTop,e.screen.width=g.width,e.screen.height=g.height};const R=function(){const g=new I;return function(O,k){return g.set((O-e.screen.left)/e.screen.width,(k-e.screen.top)/e.screen.height),g}}(),P=function(){const g=new I;return function(O,k){return g.set((O-e.screen.width*.5-e.screen.left)/(e.screen.width*.5),(e.screen.height+2*(e.screen.top-k))/e.screen.width),g}}();this.rotateCamera=function(){const g=new C,M=new Ye,O=new C,k=new C,H=new C,G=new C;return function(){G.set(b.x-m.x,b.y-m.y,0);let ee=G.length();ee?(f.copy(e.object.position).sub(e.target),O.copy(f).normalize(),k.copy(e.object.up).normalize(),H.crossVectors(k,O).normalize(),k.setLength(b.y-m.y),H.setLength(b.x-m.x),G.copy(k.add(H)),g.crossVectors(G,f).normalize(),ee*=e.rotateSpeed,M.setFromAxisAngle(g,ee),f.applyQuaternion(M),e.object.up.applyQuaternion(M),T.copy(g),d=ee):!e.staticMoving&&d&&(d*=Math.sqrt(1-e.dynamicDampingFactor),f.copy(e.object.position).sub(e.target),M.setFromAxisAngle(T,d),f.applyQuaternion(M),e.object.up.applyQuaternion(M)),m.copy(b)}}(),this.zoomCamera=function(){let g;c===s.TOUCH_ZOOM_PAN?(g=h/u,h=u,e.object.isPerspectiveCamera?f.multiplyScalar(g):e.object.isOrthographicCamera?(e.object.zoom/=g,e.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(g=1+(x.y-w.y)*e.zoomSpeed,g!==1&&g>0&&(e.object.isPerspectiveCamera?f.multiplyScalar(g):e.object.isOrthographicCamera?(e.object.zoom/=g,e.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),e.staticMoving?w.copy(x):w.y+=(x.y-w.y)*this.dynamicDampingFactor)},this.panCamera=function(){const g=new I,M=new C,O=new C;return function(){if(g.copy(A).sub(E),g.lengthSq()){if(e.object.isOrthographicCamera){const H=(e.object.right-e.object.left)/e.object.zoom/e.domElement.clientWidth,G=(e.object.top-e.object.bottom)/e.object.zoom/e.domElement.clientWidth;g.x*=H,g.y*=G}g.multiplyScalar(f.length()*e.panSpeed),O.copy(f).cross(e.object.up).setLength(g.x),O.add(M.copy(e.object.up).setLength(g.y)),e.object.position.add(O),e.target.add(O),e.staticMoving?E.copy(A):E.add(g.subVectors(A,E).multiplyScalar(e.dynamicDampingFactor))}}}(),this.checkDistances=function(){(!e.noZoom||!e.noPan)&&(f.lengthSq()>e.maxDistance*e.maxDistance&&(e.object.position.addVectors(e.target,f.setLength(e.maxDistance)),w.copy(x)),f.lengthSq()<e.minDistance*e.minDistance&&(e.object.position.addVectors(e.target,f.setLength(e.minDistance)),w.copy(x)))},this.update=function(){f.subVectors(e.object.position,e.target),e.noRotate||e.rotateCamera(),e.noZoom||e.zoomCamera(),e.noPan||e.panCamera(),e.object.position.addVectors(e.target,f),e.object.isPerspectiveCamera?(e.checkDistances(),e.object.lookAt(e.target),r.distanceToSquared(e.object.position)>i&&(e.dispatchEvent(it),r.copy(e.object.position))):e.object.isOrthographicCamera?(e.object.lookAt(e.target),(r.distanceToSquared(e.object.position)>i||a!==e.object.zoom)&&(e.dispatchEvent(it),r.copy(e.object.position),a=e.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){c=s.NONE,l=s.NONE,e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.up.copy(e.up0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),f.subVectors(e.object.position,e.target),e.object.lookAt(e.target),e.dispatchEvent(it),r.copy(e.object.position),a=e.object.zoom};function F(g){e.enabled!==!1&&(y.length===0&&(e.domElement.setPointerCapture(g.pointerId),e.domElement.addEventListener("pointermove",L),e.domElement.addEventListener("pointerup",D)),fe(g),g.pointerType==="touch"?J(g):K(g))}function L(g){e.enabled!==!1&&(g.pointerType==="touch"?ye(g):se(g))}function D(g){e.enabled!==!1&&(g.pointerType==="touch"?Ee(g):he(),de(g),y.length===0&&(e.domElement.releasePointerCapture(g.pointerId),e.domElement.removeEventListener("pointermove",L),e.domElement.removeEventListener("pointerup",D)))}function z(g){de(g)}function N(g){e.enabled!==!1&&(window.removeEventListener("keydown",N),l===s.NONE&&(g.code===e.keys[s.ROTATE]&&!e.noRotate?l=s.ROTATE:g.code===e.keys[s.ZOOM]&&!e.noZoom?l=s.ZOOM:g.code===e.keys[s.PAN]&&!e.noPan&&(l=s.PAN)))}function X(){e.enabled!==!1&&(l=s.NONE,window.addEventListener("keydown",N))}function K(g){if(c===s.NONE)switch(g.button){case e.mouseButtons.LEFT:c=s.ROTATE;break;case e.mouseButtons.MIDDLE:c=s.ZOOM;break;case e.mouseButtons.RIGHT:c=s.PAN;break}const M=l!==s.NONE?l:c;M===s.ROTATE&&!e.noRotate?(b.copy(P(g.pageX,g.pageY)),m.copy(b)):M===s.ZOOM&&!e.noZoom?(w.copy(R(g.pageX,g.pageY)),x.copy(w)):M===s.PAN&&!e.noPan&&(E.copy(R(g.pageX,g.pageY)),A.copy(E)),e.dispatchEvent(ot)}function se(g){const M=l!==s.NONE?l:c;M===s.ROTATE&&!e.noRotate?(m.copy(b),b.copy(P(g.pageX,g.pageY))):M===s.ZOOM&&!e.noZoom?x.copy(R(g.pageX,g.pageY)):M===s.PAN&&!e.noPan&&A.copy(R(g.pageX,g.pageY))}function he(){c=s.NONE,e.dispatchEvent(rt)}function U(g){if(e.enabled!==!1&&e.noZoom!==!0){switch(g.preventDefault(),g.deltaMode){case 2:w.y-=g.deltaY*.025;break;case 1:w.y-=g.deltaY*.01;break;default:w.y-=g.deltaY*25e-5;break}e.dispatchEvent(ot),e.dispatchEvent(rt)}}function J(g){switch(j(g),y.length){case 1:c=s.TOUCH_ROTATE,b.copy(P(y[0].pageX,y[0].pageY)),m.copy(b);break;default:c=s.TOUCH_ZOOM_PAN;const M=y[0].pageX-y[1].pageX,O=y[0].pageY-y[1].pageY;u=h=Math.sqrt(M*M+O*O);const k=(y[0].pageX+y[1].pageX)/2,H=(y[0].pageY+y[1].pageY)/2;E.copy(R(k,H)),A.copy(E);break}e.dispatchEvent(ot)}function ye(g){switch(j(g),y.length){case 1:m.copy(b),b.copy(P(g.pageX,g.pageY));break;default:const M=W(g),O=g.pageX-M.x,k=g.pageY-M.y;u=Math.sqrt(O*O+k*k);const H=(g.pageX+M.x)/2,G=(g.pageY+M.y)/2;A.copy(R(H,G));break}}function Ee(g){switch(y.length){case 0:c=s.NONE;break;case 1:c=s.TOUCH_ROTATE,b.copy(P(g.pageX,g.pageY)),m.copy(b);break;case 2:c=s.TOUCH_ZOOM_PAN,b.copy(P(g.pageX-m.x,g.pageY-m.y)),m.copy(b);break}e.dispatchEvent(rt)}function q(g){e.enabled!==!1&&g.preventDefault()}function fe(g){y.push(g)}function de(g){delete _[g.pointerId];for(let M=0;M<y.length;M++)if(y[M].pointerId==g.pointerId){y.splice(M,1);return}}function j(g){let M=_[g.pointerId];M===void 0&&(M=new I,_[g.pointerId]=M),M.set(g.pageX,g.pageY)}function W(g){const M=g.pointerId===y[0].pointerId?y[1]:y[0];return _[M.pointerId]}this.dispose=function(){e.domElement.removeEventListener("contextmenu",q),e.domElement.removeEventListener("pointerdown",F),e.domElement.removeEventListener("pointercancel",z),e.domElement.removeEventListener("wheel",U),e.domElement.removeEventListener("pointermove",L),e.domElement.removeEventListener("pointerup",D),window.removeEventListener("keydown",N),window.removeEventListener("keyup",X)},this.domElement.addEventListener("contextmenu",q),this.domElement.addEventListener("pointerdown",F),this.domElement.addEventListener("pointercancel",z),this.domElement.addEventListener("wheel",U,{passive:!1}),window.addEventListener("keydown",N),window.addEventListener("keyup",X),this.handleResize(),this.update()}}const Se=new An(0,0,0,"YXZ"),Ae=new C,_s={type:"change"},xs={type:"lock"},Ms={type:"unlock"},jt=Math.PI/2;class Bi extends yt{constructor(t,n){super();n===void 0&&(console.warn('THREE.PointerLockControls: The second parameter "domElement" is now mandatory.'),n=document.body),this.domElement=n,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1;const e=this;function s(a){if(e.isLocked===!1)return;const c=a.movementX||a.mozMovementX||a.webkitMovementX||0,l=a.movementY||a.mozMovementY||a.webkitMovementY||0;Se.setFromQuaternion(t.quaternion),Se.y-=c*.002*e.pointerSpeed,Se.x-=l*.002*e.pointerSpeed,Se.x=Math.max(jt-e.maxPolarAngle,Math.min(jt-e.minPolarAngle,Se.x)),t.quaternion.setFromEuler(Se),e.dispatchEvent(_s)}function i(){e.domElement.ownerDocument.pointerLockElement===e.domElement?(e.dispatchEvent(xs),e.isLocked=!0):(e.dispatchEvent(Ms),e.isLocked=!1)}function r(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){e.domElement.ownerDocument.addEventListener("mousemove",s),e.domElement.ownerDocument.addEventListener("pointerlockchange",i),e.domElement.ownerDocument.addEventListener("pointerlockerror",r)},this.disconnect=function(){e.domElement.ownerDocument.removeEventListener("mousemove",s),e.domElement.ownerDocument.removeEventListener("pointerlockchange",i),e.domElement.ownerDocument.removeEventListener("pointerlockerror",r)},this.dispose=function(){this.disconnect()},this.getObject=function(){return t},this.getDirection=function(){const a=new C(0,0,-1);return function(c){return c.copy(a).applyQuaternion(t.quaternion)}}(),this.moveForward=function(a){Ae.setFromMatrixColumn(t.matrix,0),Ae.crossVectors(t.up,Ae),t.position.addScaledVector(Ae,a)},this.moveRight=function(a){Ae.setFromMatrixColumn(t.matrix,0),t.position.addScaledVector(Ae,a)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){e.domElement.ownerDocument.exitPointerLock()},this.connect()}}class Vi extends Et{constructor(t){super(t);this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new vs(n)}),this.register(function(n){return new Ns(n)}),this.register(function(n){return new Fs(n)}),this.register(function(n){return new Cs(n)}),this.register(function(n){return new Is(n)}),this.register(function(n){return new Os(n)}),this.register(function(n){return new ks(n)}),this.register(function(n){return new Ls(n)}),this.register(function(n){return new Ds(n)}),this.register(function(n){return new Ps(n)}),this.register(function(n){return new As(n)}),this.register(function(n){return new Us(n)})}load(t,n,e,s){const i=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=Te.extractUrlBase(t),this.manager.itemStart(t);const a=function(l){s?s(l):console.error(l),i.manager.itemError(t),i.manager.itemEnd(t)},c=new He(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(l){try{i.parse(l,r,function(h){n(h),i.manager.itemEnd(t)},a)}catch(h){a(h)}},e,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,e,s){let i;const r={},a={};if(typeof t=="string")i=t;else if(Te.decodeText(new Uint8Array(t,0,4))===mn){try{r[v.KHR_BINARY_GLTF]=new js(t)}catch(u){s&&s(u);return}i=r[v.KHR_BINARY_GLTF].content}else i=Te.decodeText(new Uint8Array(t));const c=JSON.parse(i);if(c.asset===void 0||c.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new $s(c,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);a[u.name]=u,r[u.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){const u=c.extensionsUsed[h],d=c.extensionsRequired||[];switch(u){case v.KHR_MATERIALS_UNLIT:r[u]=new Rs;break;case v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[u]=new Bs;break;case v.KHR_DRACO_MESH_COMPRESSION:r[u]=new Hs(c,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:r[u]=new Gs;break;case v.KHR_MESH_QUANTIZATION:r[u]=new Vs;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(e,s)}parseAsync(t,n){const e=this;return new Promise(function(s,i){e.parse(t,n,s,i)})}}function Ss(){let o={};return{get:function(t){return o[t]},add:function(t,n){o[t]=n},remove:function(t){delete o[t]},removeAll:function(){o={}}}}const v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class As{constructor(t){this.parser=t,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let e=0,s=n.length;e<s;e++){const i=n[e];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const n=this.parser,e="light:"+t;let s=n.cache.get(e);if(s)return s;const i=n.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let l;const h=new Y(16777215);c.color!==void 0&&h.fromArray(c.color);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Ln(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Rn(h),l.distance=u;break;case"spot":l=new tn(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,c.intensity!==void 0&&(l.intensity=c.intensity),l.name=n.createUniqueName(c.name||"light_"+t),s=Promise.resolve(l),n.cache.add(e,s),s}createNodeAttachment(t){const n=this,e=this.parser,i=e.json.nodes[t],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return e._getNodeRef(n.cache,a,c)})}}class Rs{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return be}extendParams(t,n,e){const s=[];t.color=new Y(1,1,1),t.opacity=1;const i=n.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;t.color.fromArray(r),t.opacity=r[3]}i.baseColorTexture!==void 0&&s.push(e.assignTexture(t,"map",i.baseColorTexture,ce))}return Promise.all(s)}}class Ls{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name].emissiveStrength;return i!==void 0&&(n.emissiveIntensity=i),Promise.resolve()}}class vs{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(n.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(e.assignTexture(n,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(e.assignTexture(n,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(e.assignTexture(n,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new I(a,a)}return Promise.all(i)}}class Ps{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(n.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(e.assignTexture(n,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(n.iridescenceIOR=r.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(e.assignTexture(n,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class Cs{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[];n.sheenColor=new Y(0,0,0),n.sheenRoughness=0,n.sheen=1;const r=s.extensions[this.name];return r.sheenColorFactor!==void 0&&n.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(e.assignTexture(n,"sheenColorMap",r.sheenColorTexture,ce)),r.sheenRoughnessTexture!==void 0&&i.push(e.assignTexture(n,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class Is{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(n.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(e.assignTexture(n,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class Os{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];n.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(e.assignTexture(n,"thicknessMap",r.thicknessTexture)),n.attenuationDistance=r.attenuationDistance||0;const a=r.attenuationColor||[1,1,1];return n.attenuationColor=new Y(a[0],a[1],a[2]),Promise.all(i)}}class ks{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=s.extensions[this.name];return n.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Ds{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:ue}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const i=[],r=s.extensions[this.name];n.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(e.assignTexture(n,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return n.specularColor=new Y(a[0],a[1],a[2]),r.specularColorTexture!==void 0&&i.push(e.assignTexture(n,"specularColorMap",r.specularColorTexture,ce)),Promise.all(i)}}class Ns{constructor(t){this.parser=t,this.name=v.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,e=n.json,s=e.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const i=s.extensions[this.name],r=n.options.ktx2Loader;if(!r){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,i.source,r)}}class Fs{constructor(t){this.parser=t,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,e=this.parser,s=e.json,i=s.textures[t];if(!i.extensions||!i.extensions[n])return null;const r=i.extensions[n],a=s.images[r.source];let c=e.textureLoader;if(a.uri){const l=e.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return e.loadTextureImage(t,r.source,c);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class Us{constructor(t){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,e=n.bufferViews[t];if(e.extensions&&e.extensions[this.name]){const s=e.extensions[this.name],i=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then(function(a){const c=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,d=new ArrayBuffer(h*u),f=new Uint8Array(a[0],c,l);return r.decodeGltfBuffer(new Uint8Array(d),h,u,f,s.mode,s.filter),d})}else return null}}const mn="glTF",Ie=12,Ht={JSON:1313821514,BIN:5130562};class js{constructor(t){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,Ie);if(this.header={magic:Te.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==mn)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const e=this.header.length-Ie,s=new DataView(t,Ie);let i=0;for(;i<e;){const r=s.getUint32(i,!0);i+=4;const a=s.getUint32(i,!0);if(i+=4,a===Ht.JSON){const c=new Uint8Array(t,Ie+i,r);this.content=Te.decodeText(c)}else if(a===Ht.BIN){const c=Ie+i;this.body=t.slice(c,c+r)}i+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Hs{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const e=this.json,s=this.dracoLoader,i=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,a={},c={},l={};for(const h in r){const u=bt[h]||h.toLowerCase();a[u]=r[h]}for(const h in t.attributes){const u=bt[h]||h.toLowerCase();if(r[h]!==void 0){const d=e.accessors[t.attributes[h]],f=Ge[d.componentType];l[u]=f,c[u]=d.normalized===!0}}return n.getDependency("bufferView",i).then(function(h){return new Promise(function(u){s.decodeDracoFile(h,function(d){for(const f in d.attributes){const m=d.attributes[f],b=c[f];b!==void 0&&(m.normalized=b)}u(d)},a,l)})})}}class Gs{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return n.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class gt extends Pe{constructor(t){super();this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),e=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new Y().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(c){for(const l in a)c.uniforms[l]=a[l];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",e).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(c){a.specular.value=c}},specularMap:{get:function(){return a.specularMap.value},set:function(c){a.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(c){a.glossiness.value=c}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(c){a.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Bs{constructor(){this.name=v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return gt}extendParams(t,n,e){const s=n.extensions[this.name];t.color=new Y(1,1,1),t.opacity=1;const i=[];if(Array.isArray(s.diffuseFactor)){const r=s.diffuseFactor;t.color.fromArray(r),t.opacity=r[3]}if(s.diffuseTexture!==void 0&&i.push(e.assignTexture(t,"map",s.diffuseTexture,ce)),t.emissive=new Y(0,0,0),t.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,t.specular=new Y(1,1,1),Array.isArray(s.specularFactor)&&t.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const r=s.specularGlossinessTexture;i.push(e.assignTexture(t,"glossinessMap",r)),i.push(e.assignTexture(t,"specularMap",r,ce))}return Promise.all(i)}createMaterial(t){const n=new gt(t);return n.fog=!0,n.color=t.color,n.map=t.map===void 0?null:t.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=t.aoMap===void 0?null:t.aoMap,n.aoMapIntensity=1,n.emissive=t.emissive,n.emissiveIntensity=t.emissiveIntensity===void 0?1:t.emissiveIntensity,n.emissiveMap=t.emissiveMap===void 0?null:t.emissiveMap,n.bumpMap=t.bumpMap===void 0?null:t.bumpMap,n.bumpScale=1,n.normalMap=t.normalMap===void 0?null:t.normalMap,n.normalMapType=vn,t.normalScale&&(n.normalScale=t.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=t.specularMap===void 0?null:t.specularMap,n.specular=t.specular,n.glossinessMap=t.glossinessMap===void 0?null:t.glossinessMap,n.glossiness=t.glossiness,n.alphaMap=null,n.envMap=t.envMap===void 0?null:t.envMap,n.envMapIntensity=1,n}}class Vs{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class Mt extends Pn{constructor(t,n,e,s){super(t,n,e,s)}copySampleValue_(t){const n=this.resultBuffer,e=this.sampleValues,s=this.valueSize,i=t*s*3+s;for(let r=0;r!==s;r++)n[r]=e[i+r];return n}}Mt.prototype.interpolate_=function(o,t,n,e){const s=this.resultBuffer,i=this.sampleValues,r=this.valueSize,a=r*2,c=r*3,l=e-t,h=(n-t)/l,u=h*h,d=u*h,f=o*c,m=f-c,b=-2*d+3*u,T=d-u,w=1-b,x=T-u+h;for(let E=0;E!==r;E++){const A=i[m+E+r],y=i[m+E+a]*l,_=i[f+E+r],R=i[f+E]*l;s[E]=w*A+x*y+b*_+T*R}return s};const Ks=new Ye;class zs extends Mt{interpolate_(t,n,e,s){const i=super.interpolate_(t,n,e,s);return Ks.fromArray(i).normalize().toArray(i),i}}const re={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ge={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Gt={9728:Cn,9729:nn,9984:In,9985:On,9986:kn,9987:sn},Bt={33071:Dn,33648:Nn,10497:dt},Vt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},le={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Xs={CUBICSPLINE:void 0,LINEAR:on,STEP:Fn},at={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ys(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Pe({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Jn})),o.DefaultMaterial}function Oe(o,t,n){for(const e in n.extensions)o[e]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[e]=n.extensions[e])}function me(o,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(o.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function qs(o,t,n){let e=!1,s=!1,i=!1;for(let l=0,h=t.length;l<h;l++){const u=t[l];if(u.POSITION!==void 0&&(e=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(i=!0),e&&s&&i)break}if(!e&&!s&&!i)return Promise.resolve(o);const r=[],a=[],c=[];for(let l=0,h=t.length;l<h;l++){const u=t[l];if(e){const d=u.POSITION!==void 0?n.getDependency("accessor",u.POSITION):o.attributes.position;r.push(d)}if(s){const d=u.NORMAL!==void 0?n.getDependency("accessor",u.NORMAL):o.attributes.normal;a.push(d)}if(i){const d=u.COLOR_0!==void 0?n.getDependency("accessor",u.COLOR_0):o.attributes.color;c.push(d)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],d=l[2];return e&&(o.morphAttributes.position=h),s&&(o.morphAttributes.normal=u),i&&(o.morphAttributes.color=d),o.morphTargetsRelative=!0,o})}function Ws(o,t){if(o.updateMorphTargets(),t.weights!==void 0)for(let n=0,e=t.weights.length;n<e;n++)o.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(o.morphTargetInfluences.length===n.length){o.morphTargetDictionary={};for(let e=0,s=n.length;e<s;e++)o.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zs(o){const t=o.extensions&&o.extensions[v.KHR_DRACO_MESH_COMPRESSION];let n;return t?n="draco:"+t.bufferView+":"+t.indices+":"+Kt(t.attributes):n=o.indices+":"+Kt(o.attributes)+":"+o.mode,n}function Kt(o){let t="";const n=Object.keys(o).sort();for(let e=0,s=n.length;e<s;e++)t+=n[e]+":"+o[n[e]]+";";return t}function Tt(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Qs(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class $s{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Ss,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,i=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||e||s&&i<98?this.textureLoader=new rn(this.options.manager):this.textureLoader=new Un(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new He(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const e=this,s=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:e,userData:{}};Oe(i,a,s),me(a,s),Promise.all(e._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){t(a)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],e=this.json.meshes||[];for(let s=0,i=n.length;s<i;s++){const r=n[s].joints;for(let a=0,c=r.length;a<c;a++)t[r[a]].isBone=!0}for(let s=0,i=t.length;s<i;s++){const r=t[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(e[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,e){if(t.refs[n]<=1)return e;const s=e.clone(),i=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[l,h]of r.children.entries())i(h,a.children[l])};return i(e,s),s.name+="_instance_"+t.uses[n]++,s}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){const s=t(n[e]);if(s)return s}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const e=[];for(let s=0;s<n.length;s++){const i=t(n[s]);i&&e.push(i)}return e}getDependency(t,n){const e=t+":"+n;let s=this.cache.get(e);if(!s){switch(t){case"scene":s=this.loadScene(n);break;case"node":s=this.loadNode(n);break;case"mesh":s=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:throw new Error("Unknown type: "+t)}this.cache.add(e,s)}return s}getDependencies(t){let n=this.cache.get(t);if(!n){const e=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(i,r){return e.getDependency(t,r)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],e=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(i,r){e.load(Te.resolveURL(n.uri,s.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(e){const s=n.byteLength||0,i=n.byteOffset||0;return e.slice(i,i+s)})}loadAccessor(t){const n=this,e=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const i=[];return s.bufferView!==void 0?i.push(this.getDependency("bufferView",s.bufferView)):i.push(null),s.sparse!==void 0&&(i.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(i).then(function(r){const a=r[0],c=Vt[s.type],l=Ge[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,d=s.byteOffset||0,f=s.bufferView!==void 0?e.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let b,T;if(f&&f!==u){const w=Math.floor(d/f),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+w+":"+s.count;let E=n.cache.get(x);E||(b=new l(a,w*f,s.count*f/h),E=new jn(b,f/h),n.cache.add(x,E)),T=new Hn(E,c,d%f/h,m)}else a===null?b=new l(s.count*c):b=new l(a,d,s.count*c),T=new qe(b,c,m);if(s.sparse!==void 0){const w=Vt.SCALAR,x=Ge[s.sparse.indices.componentType],E=s.sparse.indices.byteOffset||0,A=s.sparse.values.byteOffset||0,y=new x(r[1],E,s.sparse.count*w),_=new l(r[2],A,s.sparse.count*c);a!==null&&(T=new qe(T.array.slice(),T.itemSize,T.normalized));for(let R=0,P=y.length;R<P;R++){const F=y[R];if(T.setX(F,_[R*c]),c>=2&&T.setY(F,_[R*c+1]),c>=3&&T.setZ(F,_[R*c+2]),c>=4&&T.setW(F,_[R*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return T})}loadTexture(t){const n=this.json,e=this.options,i=n.textures[t].source,r=n.images[i];let a=this.textureLoader;if(r.uri){const c=e.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(t,i,a)}loadTextureImage(t,n,e){const s=this,i=this.json,r=i.textures[t],a=i.images[n],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(n,e).then(function(h){h.flipY=!1,r.name&&(h.name=r.name);const d=(i.samplers||{})[r.sampler]||{};return h.magFilter=Gt[d.magFilter]||nn,h.minFilter=Gt[d.minFilter]||sn,h.wrapS=Bt[d.wrapS]||dt,h.wrapT=Bt[d.wrapT]||dt,s.associations.set(h,{textures:t}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(t,n){const e=this,s=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(u=>u.clone());const r=s.images[t],a=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=e.getDependency("bufferView",r.bufferView).then(function(u){l=!0;const d=new Blob([u],{type:r.mimeType});return c=a.createObjectURL(d),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(d,f){let m=d;n.isImageBitmapLoader===!0&&(m=function(b){const T=new kt(b);T.needsUpdate=!0,d(T)}),n.load(Te.resolveURL(u,i.path),m,void 0,f)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=r.mimeType||Qs(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[t]=h,h}assignTexture(t,n,e,s){const i=this;return this.getDependency("texture",e.index).then(function(r){if(e.texCoord!==void 0&&e.texCoord!=0&&!(n==="aoMap"&&e.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+e.texCoord+" for texture "+n+" not yet supported."),i.extensions[v.KHR_TEXTURE_TRANSFORM]){const a=e.extensions!==void 0?e.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(r);r=i.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,c)}}return s!==void 0&&(r.encoding=s),t[n]=r,r})}assignFinalMaterial(t){const n=t.geometry;let e=t.material;const s=n.attributes.tangent===void 0,i=n.attributes.color!==void 0,r=n.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+e.uuid;let c=this.cache.get(a);c||(c=new ke,Ne.prototype.copy.call(c,e),c.color.copy(e.color),c.map=e.map,c.sizeAttenuation=!1,this.cache.add(a,c)),e=c}else if(t.isLine){const a="LineBasicMaterial:"+e.uuid;let c=this.cache.get(a);c||(c=new ze,Ne.prototype.copy.call(c,e),c.color.copy(e.color),this.cache.add(a,c)),e=c}if(s||i||r){let a="ClonedMaterial:"+e.uuid+":";e.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=e.clone(),i&&(c.vertexColors=!0),r&&(c.flatShading=!0),s&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(e))),e=c}e.aoMap&&n.attributes.uv2===void 0&&n.attributes.uv!==void 0&&n.setAttribute("uv2",n.attributes.uv),t.material=e}getMaterialType(){return Pe}loadMaterial(t){const n=this,e=this.json,s=this.extensions,i=e.materials[t];let r;const a={},c=i.extensions||{},l=[];if(c[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=s[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=u.getMaterialType(),l.push(u.extendParams(a,i,n))}else if(c[v.KHR_MATERIALS_UNLIT]){const u=s[v.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),l.push(u.extendParams(a,i,n))}else{const u=i.pbrMetallicRoughness||{};if(a.color=new Y(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}u.baseColorTexture!==void 0&&l.push(n.assignTexture(a,"map",u.baseColorTexture,ce)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(n.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,a)})))}i.doubleSided===!0&&(a.side=_t);const h=i.alphaMode||at.OPAQUE;if(h===at.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===at.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==be&&(l.push(n.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new I(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;a.normalScale.set(u,u)}return i.occlusionTexture!==void 0&&r!==be&&(l.push(n.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==be&&(a.emissive=new Y().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&r!==be&&l.push(n.assignTexture(a,"emissiveMap",i.emissiveTexture,ce)),Promise.all(l).then(function(){let u;return r===gt?u=s[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new r(a),i.name&&(u.name=i.name),me(u,i),n.associations.set(u,{materials:t}),i.extensions&&Oe(s,u,i),u})}createUniqueName(t){const n=Gn.sanitizeNodeName(t||"");let e=n;for(let s=1;this.nodeNamesUsed[e];++s)e=n+"_"+s;return this.nodeNamesUsed[e]=!0,e}loadGeometries(t){const n=this,e=this.extensions,s=this.primitiveCache;function i(a){return e[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(c){return zt(c,a,n)})}const r=[];for(let a=0,c=t.length;a<c;a++){const l=t[a],h=Zs(l),u=s[h];if(u)r.push(u.promise);else{let d;l.extensions&&l.extensions[v.KHR_DRACO_MESH_COMPRESSION]?d=i(l):d=zt(new we,l,n),s[h]={primitive:l,promise:d},r.push(d)}}return Promise.all(r)}loadMesh(t){const n=this,e=this.json,s=this.extensions,i=e.meshes[t],r=i.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const h=r[c].material===void 0?Ys(this.cache):this.getDependency("material",r[c].material);a.push(h)}return a.push(n.loadGeometries(r)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let f=0,m=h.length;f<m;f++){const b=h[f],T=r[f];let w;const x=l[f];if(T.mode===re.TRIANGLES||T.mode===re.TRIANGLE_STRIP||T.mode===re.TRIANGLE_FAN||T.mode===void 0)w=i.isSkinnedMesh===!0?new Bn(b,x):new ve(b,x),w.isSkinnedMesh===!0&&!w.geometry.attributes.skinWeight.normalized&&w.normalizeSkinWeights(),T.mode===re.TRIANGLE_STRIP?w.geometry=Xt(w.geometry,Vn):T.mode===re.TRIANGLE_FAN&&(w.geometry=Xt(w.geometry,an));else if(T.mode===re.LINES)w=new We(b,x);else if(T.mode===re.LINE_STRIP)w=new Kn(b,x);else if(T.mode===re.LINE_LOOP)w=new zn(b,x);else if(T.mode===re.POINTS)w=new Xe(b,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+T.mode);Object.keys(w.geometry.morphAttributes).length>0&&Ws(w,i),w.name=n.createUniqueName(i.name||"mesh_"+t),me(w,i),T.extensions&&Oe(s,w,T),n.assignFinalMaterial(w),u.push(w)}for(let f=0,m=u.length;f<m;f++)n.associations.set(u[f],{meshes:t,primitives:f});if(u.length===1)return u[0];const d=new Fe;n.associations.set(d,{meshes:t});for(let f=0,m=u.length;f<m;f++)d.add(u[f]);return d})}loadCamera(t){let n;const e=this.json.cameras[t],s=e[e.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?n=new Xn(pe.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):e.type==="orthographic"&&(n=new xt(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),e.name&&(n.name=this.createUniqueName(e.name)),me(n,e),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],e={joints:n.joints};return n.inverseBindMatrices===void 0?Promise.resolve(e):this.getDependency("accessor",n.inverseBindMatrices).then(function(s){return e.inverseBindMatrices=s,e})}loadAnimation(t){const e=this.json.animations[t],s=[],i=[],r=[],a=[],c=[];for(let l=0,h=e.channels.length;l<h;l++){const u=e.channels[l],d=e.samplers[u.sampler],f=u.target,m=f.node!==void 0?f.node:f.id,b=e.parameters!==void 0?e.parameters[d.input]:d.input,T=e.parameters!==void 0?e.parameters[d.output]:d.output;s.push(this.getDependency("node",m)),i.push(this.getDependency("accessor",b)),r.push(this.getDependency("accessor",T)),a.push(d),c.push(f)}return Promise.all([Promise.all(s),Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],d=l[2],f=l[3],m=l[4],b=[];for(let w=0,x=h.length;w<x;w++){const E=h[w],A=u[w],y=d[w],_=f[w],R=m[w];if(E===void 0)continue;E.updateMatrix(),E.matrixAutoUpdate=!0;let P;switch(le[R.path]){case le.weights:P=qn;break;case le.rotation:P=Ot;break;case le.position:case le.scale:default:P=Yn;break}const F=E.name?E.name:E.uuid,L=_.interpolation!==void 0?Xs[_.interpolation]:on,D=[];le[R.path]===le.weights?E.traverse(function(N){N.morphTargetInfluences&&D.push(N.name?N.name:N.uuid)}):D.push(F);let z=y.array;if(y.normalized){const N=Tt(z.constructor),X=new Float32Array(z.length);for(let K=0,se=z.length;K<se;K++)X[K]=z[K]*N;z=X}for(let N=0,X=D.length;N<X;N++){const K=new P(D[N]+"."+le[R.path],A.array,z,L);_.interpolation==="CUBICSPLINE"&&(K.createInterpolant=function(he){const U=this instanceof Ot?zs:Mt;return new U(this.times,this.values,this.getValueSize()/3,he)},K.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(K)}}const T=e.name?e.name:"animation_"+t;return new Wn(T,void 0,b)})}createNodeMesh(t){const n=this.json,e=this,s=n.nodes[t];return s.mesh===void 0?null:e.getDependency("mesh",s.mesh).then(function(i){const r=e._getNodeRef(e.meshCache,s.mesh,i);return s.weights!==void 0&&r.traverse(function(a){if(!!a.isMesh)for(let c=0,l=s.weights.length;c<l;c++)a.morphTargetInfluences[c]=s.weights[c]}),r})}loadNode(t){const n=this.json,e=this.extensions,s=this,i=n.nodes[t],r=i.name?s.createUniqueName(i.name):"";return function(){const a=[],c=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return c&&a.push(c),i.camera!==void 0&&a.push(s.getDependency("camera",i.camera).then(function(l){return s._getNodeRef(s.cameraCache,i.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let c;if(i.isBone===!0?c=new Zn:a.length>1?c=new Fe:a.length===1?c=a[0]:c=new Qn,c!==a[0])for(let l=0,h=a.length;l<h;l++)c.add(a[l]);if(i.name&&(c.userData.name=i.name,c.name=r),me(c,i),i.extensions&&Oe(e,c,i),i.matrix!==void 0){const l=new cn;l.fromArray(i.matrix),c.applyMatrix4(l)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=t,c})}loadScene(t){const n=this.json,e=this.extensions,s=this.json.scenes[t],i=this,r=new Fe;s.name&&(r.name=i.createUniqueName(s.name)),me(r,s),s.extensions&&Oe(e,r,s);const a=s.nodes||[],c=[];for(let l=0,h=a.length;l<h;l++)c.push(gn(a[l],r,n,i));return Promise.all(c).then(function(){const l=h=>{const u=new Map;for(const[d,f]of i.associations)(d instanceof Ne||d instanceof kt)&&u.set(d,f);return h.traverse(d=>{const f=i.associations.get(d);f!=null&&u.set(d,f)}),u};return i.associations=l(r),r})}}function gn(o,t,n,e){const s=n.nodes[o];return e.getDependency("node",o).then(function(i){if(s.skin===void 0)return i;let r;return e.getDependency("skin",s.skin).then(function(a){r=a;const c=[];for(let l=0,h=r.joints.length;l<h;l++)c.push(e.getDependency("node",r.joints[l]));return Promise.all(c)}).then(function(a){return i.traverse(function(c){if(!c.isMesh)return;const l=[],h=[];for(let u=0,d=a.length;u<d;u++){const f=a[u];if(f){l.push(f);const m=new cn;r.inverseBindMatrices!==void 0&&m.fromArray(r.inverseBindMatrices.array,u*16),h.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[u])}c.bind(new $n(l,h),c.matrixWorld)}),i})}).then(function(i){t.add(i);const r=[];if(s.children){const a=s.children;for(let c=0,l=a.length;c<l;c++){const h=a[c];r.push(gn(h,i,n,e))}}return Promise.all(r)})}function Js(o,t,n){const e=t.attributes,s=new es;if(e.POSITION!==void 0){const a=n.json.accessors[e.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(s.set(new C(c[0],c[1],c[2]),new C(l[0],l[1],l[2])),a.normalized){const h=Tt(Ge[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=t.targets;if(i!==void 0){const a=new C,c=new C;for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u.POSITION!==void 0){const d=n.json.accessors[u.POSITION],f=d.min,m=d.max;if(f!==void 0&&m!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),d.normalized){const b=Tt(Ge[d.componentType]);c.multiplyScalar(b)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}o.boundingBox=s;const r=new ts;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,o.boundingSphere=r}function zt(o,t,n){const e=t.attributes,s=[];function i(r,a){return n.getDependency("accessor",r).then(function(c){o.setAttribute(a,c)})}for(const r in e){const a=bt[r]||r.toLowerCase();a in o.attributes||s.push(i(e[r],a))}if(t.indices!==void 0&&!o.index){const r=n.getDependency("accessor",t.indices).then(function(a){o.setIndex(a)});s.push(r)}return me(o,t),Js(o,t,n),Promise.all(s).then(function(){return t.targets!==void 0?qs(o,t.targets,n):o})}function Xt(o,t){let n=o.getIndex();if(n===null){const r=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);o.setIndex(r),n=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const e=n.count-2,s=[];if(t===an)for(let r=1;r<=e;r++)s.push(n.getX(0)),s.push(n.getX(r)),s.push(n.getX(r+1));else for(let r=0;r<e;r++)r%2===0?(s.push(n.getX(r)),s.push(n.getX(r+1)),s.push(n.getX(r+2))):(s.push(n.getX(r+2)),s.push(n.getX(r+1)),s.push(n.getX(r)));s.length/3!==e&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=o.clone();return i.setIndex(s),i}const ct=new WeakMap;class Ki extends Et{constructor(t){super(t);this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,n,e,s){const i=new He(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,r=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(r,a).then(n).catch(s)},e,s)}decodeDracoFile(t,n,e,s){const i={attributeIDs:e||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!e};this.decodeGeometry(t,i).then(n)}decodeGeometry(t,n){for(const c in n.attributeTypes){const l=n.attributeTypes[c];l.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[c]=l.name)}const e=JSON.stringify(n);if(ct.has(t)){const c=ct.get(t);if(c.key===e)return c.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const i=this.workerNextTaskID++,r=t.byteLength,a=this._getWorker(i,r).then(c=>(s=c,new Promise((l,h)=>{s._callbacks[i]={resolve:l,reject:h},s.postMessage({type:"decode",id:i,taskConfig:n,buffer:t},[t])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{s&&i&&this._releaseTask(s,i)}),ct.set(t,{key:e,promise:a}),a}_createGeometry(t){const n=new we;t.index&&n.setIndex(new qe(t.index.array,1));for(let e=0;e<t.attributes.length;e++){const s=t.attributes[e],i=s.name,r=s.array,a=s.itemSize;n.setAttribute(i,new qe(r,a))}return n}_loadLibrary(t,n){const e=new He(this.manager);return e.setPath(this.decoderPath),e.setResponseType(n),e.setWithCredentials(this.withCredentials),new Promise((s,i)=>{e.load(t,s,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(e=>{const s=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const i=ei.toString(),r=["/* draco decoder */",s,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(t,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(i){const r=i.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,i){return s._taskLoad>i._taskLoad?-1:1});const e=this.workerPool[this.workerPool.length-1];return e._taskCosts[t]=n,e._taskLoad+=n,e})}_releaseTask(t,n){t._taskLoad-=t._taskCosts[n],delete t._callbacks[n],delete t._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function ei(){let o,t;onmessage=function(r){const a=r.data;switch(a.type){case"init":o=a.decoderConfig,t=new Promise(function(h){o.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(o)});break;case"decode":const c=a.buffer,l=a.taskConfig;t.then(h=>{const u=h.draco,d=new u.Decoder,f=new u.DecoderBuffer;f.Init(new Int8Array(c),c.byteLength);try{const m=n(u,d,f,l),b=m.attributes.map(T=>T.array.buffer);m.index&&b.push(m.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:m},b)}catch(m){console.error(m),self.postMessage({type:"error",id:a.id,error:m.message})}finally{u.destroy(f),u.destroy(d)}});break}};function n(r,a,c,l){const h=l.attributeIDs,u=l.attributeTypes;let d,f;const m=a.GetEncodedGeometryType(c);if(m===r.TRIANGULAR_MESH)d=new r.Mesh,f=a.DecodeBufferToMesh(c,d);else if(m===r.POINT_CLOUD)d=new r.PointCloud,f=a.DecodeBufferToPointCloud(c,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const b={index:null,attributes:[]};for(const T in h){const w=self[u[T]];let x,E;if(l.useUniqueIDs)E=h[T],x=a.GetAttributeByUniqueId(d,E);else{if(E=a.GetAttributeId(d,r[h[T]]),E===-1)continue;x=a.GetAttribute(d,E)}b.attributes.push(s(r,a,d,T,w,x))}return m===r.TRIANGULAR_MESH&&(b.index=e(r,a,d)),r.destroy(d),b}function e(r,a,c){const h=c.num_faces()*3,u=h*4,d=r._malloc(u);a.GetTrianglesUInt32Array(c,u,d);const f=new Uint32Array(r.HEAPF32.buffer,d,h).slice();return r._free(d),{array:f,itemSize:1}}function s(r,a,c,l,h,u){const d=u.num_components(),m=c.num_points()*d,b=m*h.BYTES_PER_ELEMENT,T=i(r,h),w=r._malloc(b);a.GetAttributeDataArrayForAllPoints(c,u,T,b,w);const x=new h(r.HEAPF32.buffer,w,m).slice();return r._free(w),{name:l,array:x,itemSize:d}}function i(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}var Ue=function(){var o=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(h){h.preventDefault(),e(++o%t.children.length)},!1);function n(h){return t.appendChild(h.dom),h}function e(h){for(var u=0;u<t.children.length;u++)t.children[u].style.display=u===h?"block":"none";o=h}var s=(performance||Date).now(),i=s,r=0,a=n(new Ue.Panel("FPS","#0ff","#002")),c=n(new Ue.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new Ue.Panel("MB","#f08","#201"));return e(0),{REVISION:16,dom:t,addPanel:n,showPanel:e,begin:function(){s=(performance||Date).now()},end:function(){r++;var h=(performance||Date).now();if(c.update(h-s,200),h>=i+1e3&&(a.update(r*1e3/(h-i),100),i=h,r=0,l)){var u=performance.memory;l.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){s=this.end()},domElement:t,setMode:e}};Ue.Panel=function(o,t,n){var e=1/0,s=0,i=Math.round,r=i(window.devicePixelRatio||1),a=80*r,c=48*r,l=3*r,h=2*r,u=3*r,d=15*r,f=74*r,m=30*r,b=document.createElement("canvas");b.width=a,b.height=c,b.style.cssText="width:80px;height:48px";var T=b.getContext("2d");return T.font="bold "+9*r+"px Helvetica,Arial,sans-serif",T.textBaseline="top",T.fillStyle=n,T.fillRect(0,0,a,c),T.fillStyle=t,T.fillText(o,l,h),T.fillRect(u,d,f,m),T.fillStyle=n,T.globalAlpha=.9,T.fillRect(u,d,f,m),{dom:b,update:function(w,x){e=Math.min(e,w),s=Math.max(s,w),T.fillStyle=n,T.globalAlpha=1,T.fillRect(0,0,a,d),T.fillStyle=t,T.fillText(i(w)+" "+o+" ("+i(e)+"-"+i(s)+")",l,h),T.drawImage(b,u+r,d,f-r,m,u,d,f-r,m),T.fillRect(u+f-r,d,r,m),T.fillStyle=n,T.globalAlpha=.9,T.fillRect(u+f-r,d,r,i((1-w/x)*m))}}};class ti extends ln{constructor(t){super(t)}parse(t,n){const e={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=542327876,i=131072,r=512,a=1024,c=2048,l=4096,h=8192,u=16384,d=32768;function f(j){return j.charCodeAt(0)+(j.charCodeAt(1)<<8)+(j.charCodeAt(2)<<16)+(j.charCodeAt(3)<<24)}function m(j){return String.fromCharCode(j&255,j>>8&255,j>>16&255,j>>24&255)}function b(j,W,g,M){const O=g*M*4,k=new Uint8Array(j,W,O),H=new Uint8Array(O);let G=0,Q=0;for(let ee=0;ee<M;ee++)for(let _e=0;_e<g;_e++){const Ce=k[Q];Q++;const Be=k[Q];Q++;const $e=k[Q];Q++;const Je=k[Q];Q++,H[G]=$e,G++,H[G]=Be,G++,H[G]=Ce,G++,H[G]=Je,G++}return H}const T=f("DXT1"),w=f("DXT3"),x=f("DXT5"),E=f("ETC1"),A=31,y=0,_=1,R=2,P=3,F=4,L=7,D=21,z=22,N=23,X=24,K=25,se=26,he=28,U=new Int32Array(t,0,A);if(U[y]!==s)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),e;let J;const ye=U[D];let Ee=!1;switch(ye){case T:J=8,e.format=rs;break;case w:J=16,e.format=os;break;case x:J=16,e.format=is;break;case E:J=8,e.format=ss;break;default:if(U[z]===32&&U[N]&16711680&&U[X]&65280&&U[K]&255&&U[se]&4278190080)Ee=!0,J=64,e.format=ns;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",m(ye)),e}e.mipmapCount=1,U[R]&i&&n!==!1&&(e.mipmapCount=Math.max(1,U[L]));const q=U[he];if(e.isCubemap=!!(q&r),e.isCubemap&&(!(q&a)||!(q&c)||!(q&l)||!(q&h)||!(q&u)||!(q&d)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),e;e.width=U[F],e.height=U[P];let fe=U[_]+4;const de=e.isCubemap?6:1;for(let j=0;j<de;j++){let W=e.width,g=e.height;for(let M=0;M<e.mipmapCount;M++){let O,k;Ee?(O=b(t,fe,W,g),k=O.length):(k=Math.max(4,W)/4*Math.max(4,g)/4*J,O=new Uint8Array(t,fe,k));const H={data:O,width:W,height:g};e.mipmaps.push(H),fe+=k,W=Math.max(W>>1,1),g=Math.max(g>>1,1)}}return e}}const ni=/^[og]\s*(.+)?/,si=/^mtllib /,ii=/^usemtl /,oi=/^usemap /,Yt=new C,lt=new C,qt=new C,Wt=new C,Z=new C,Ke=new Y;function ri(){const o={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,n){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=n!==!1;return}const e=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:n!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,i){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:r!==void 0?r.smooth:this.smooth,groupStart:r!==void 0?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),s&&this.materials.length>1)for(let r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},e&&e.name&&typeof e.clone=="function"){const s=e.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,n){const e=parseInt(t,10);return(e>=0?e-1:e+n/3)*3},parseNormalIndex:function(t,n){const e=parseInt(t,10);return(e>=0?e-1:e+n/3)*3},parseUVIndex:function(t,n){const e=parseInt(t,10);return(e>=0?e-1:e+n/2)*2},addVertex:function(t,n,e){const s=this.vertices,i=this.object.geometry.vertices;i.push(s[t+0],s[t+1],s[t+2]),i.push(s[n+0],s[n+1],s[n+2]),i.push(s[e+0],s[e+1],s[e+2])},addVertexPoint:function(t){const n=this.vertices;this.object.geometry.vertices.push(n[t+0],n[t+1],n[t+2])},addVertexLine:function(t){const n=this.vertices;this.object.geometry.vertices.push(n[t+0],n[t+1],n[t+2])},addNormal:function(t,n,e){const s=this.normals,i=this.object.geometry.normals;i.push(s[t+0],s[t+1],s[t+2]),i.push(s[n+0],s[n+1],s[n+2]),i.push(s[e+0],s[e+1],s[e+2])},addFaceNormal:function(t,n,e){const s=this.vertices,i=this.object.geometry.normals;Yt.fromArray(s,t),lt.fromArray(s,n),qt.fromArray(s,e),Z.subVectors(qt,lt),Wt.subVectors(Yt,lt),Z.cross(Wt),Z.normalize(),i.push(Z.x,Z.y,Z.z),i.push(Z.x,Z.y,Z.z),i.push(Z.x,Z.y,Z.z)},addColor:function(t,n,e){const s=this.colors,i=this.object.geometry.colors;s[t]!==void 0&&i.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&i.push(s[n+0],s[n+1],s[n+2]),s[e]!==void 0&&i.push(s[e+0],s[e+1],s[e+2])},addUV:function(t,n,e){const s=this.uvs,i=this.object.geometry.uvs;i.push(s[t+0],s[t+1]),i.push(s[n+0],s[n+1]),i.push(s[e+0],s[e+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const n=this.uvs;this.object.geometry.uvs.push(n[t+0],n[t+1])},addFace:function(t,n,e,s,i,r,a,c,l){const h=this.vertices.length;let u=this.parseVertexIndex(t,h),d=this.parseVertexIndex(n,h),f=this.parseVertexIndex(e,h);if(this.addVertex(u,d,f),this.addColor(u,d,f),a!==void 0&&a!==""){const m=this.normals.length;u=this.parseNormalIndex(a,m),d=this.parseNormalIndex(c,m),f=this.parseNormalIndex(l,m),this.addNormal(u,d,f)}else this.addFaceNormal(u,d,f);if(s!==void 0&&s!==""){const m=this.uvs.length;u=this.parseUVIndex(s,m),d=this.parseUVIndex(i,m),f=this.parseUVIndex(r,m),this.addUV(u,d,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const n=this.vertices.length;for(let e=0,s=t.length;e<s;e++){const i=this.parseVertexIndex(t[e],n);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(t,n){this.object.geometry.type="Line";const e=this.vertices.length,s=this.uvs.length;for(let i=0,r=t.length;i<r;i++)this.addVertexLine(this.parseVertexIndex(t[i],e));for(let i=0,r=n.length;i<r;i++)this.addUVLine(this.parseUVIndex(n[i],s))}};return o.startObject("",!1),o}class ai extends Et{constructor(t){super(t);this.materials=null}load(t,n,e,s){const i=this,r=new He(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,function(a){try{n(i.parse(a))}catch(c){s?s(c):console.error(c),i.manager.itemError(t)}},e,s)}setMaterials(t){return this.materials=t,this}parse(t){const n=new ri;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const e=t.split(`
`);let s="",i="",r=0,a=[];const c=typeof"".trimLeft=="function";for(let u=0,d=e.length;u<d;u++)if(s=e[u],s=c?s.trimLeft():s.trim(),r=s.length,r!==0&&(i=s.charAt(0),i!=="#"))if(i==="v"){const f=s.split(/\s+/);switch(f[0]){case"v":n.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?(Ke.setRGB(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])).convertSRGBToLinear(),n.colors.push(Ke.r,Ke.g,Ke.b)):n.colors.push(void 0,void 0,void 0);break;case"vn":n.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":n.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(i==="f"){const m=s.slice(1).trim().split(/\s+/),b=[];for(let w=0,x=m.length;w<x;w++){const E=m[w];if(E.length>0){const A=E.split("/");b.push(A)}}const T=b[0];for(let w=1,x=b.length-1;w<x;w++){const E=b[w],A=b[w+1];n.addFace(T[0],E[0],A[0],T[1],E[1],A[1],T[2],E[2],A[2])}}else if(i==="l"){const f=s.substring(1).trim().split(" ");let m=[];const b=[];if(s.indexOf("/")===-1)m=f;else for(let T=0,w=f.length;T<w;T++){const x=f[T].split("/");x[0]!==""&&m.push(x[0]),x[1]!==""&&b.push(x[1])}n.addLineGeometry(m,b)}else if(i==="p"){const m=s.slice(1).trim().split(" ");n.addPointGeometry(m)}else if((a=ni.exec(s))!==null){const f=(" "+a[0].slice(1).trim()).slice(1);n.startObject(f)}else if(ii.test(s))n.object.startMaterial(s.substring(7).trim(),n.materialLibraries);else if(si.test(s))n.materialLibraries.push(s.substring(7).trim());else if(oi.test(s))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(i==="s"){if(a=s.split(" "),a.length>1){const m=a[1].trim().toLowerCase();n.object.smooth=m!=="0"&&m!=="off"}else n.object.smooth=!0;const f=n.object.currentMaterial();f&&(f.smooth=n.object.smooth)}else{if(s==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+s+'"')}n.finalize();const l=new Fe;if(l.materialLibraries=[].concat(n.materialLibraries),!(n.objects.length===1&&n.objects[0].geometry.vertices.length===0)===!0)for(let u=0,d=n.objects.length;u<d;u++){const f=n.objects[u],m=f.geometry,b=f.materials,T=m.type==="Line",w=m.type==="Points";let x=!1;if(m.vertices.length===0)continue;const E=new we;E.setAttribute("position",new te(m.vertices,3)),m.normals.length>0&&E.setAttribute("normal",new te(m.normals,3)),m.colors.length>0&&(x=!0,E.setAttribute("color",new te(m.colors,3))),m.hasUVIndices===!0&&E.setAttribute("uv",new te(m.uvs,2));const A=[];for(let _=0,R=b.length;_<R;_++){const P=b[_],F=P.name+"_"+P.smooth+"_"+x;let L=n.materials[F];if(this.materials!==null){if(L=this.materials.create(P.name),T&&L&&!(L instanceof ze)){const D=new ze;Ne.prototype.copy.call(D,L),D.color.copy(L.color),L=D}else if(w&&L&&!(L instanceof ke)){const D=new ke({size:10,sizeAttenuation:!1});Ne.prototype.copy.call(D,L),D.color.copy(L.color),D.map=L.map,L=D}}L===void 0&&(T?L=new ze:w?L=new ke({size:1,sizeAttenuation:!1}):L=new un,L.name=P.name,L.flatShading=!P.smooth,L.vertexColors=x,n.materials[F]=L),A.push(L)}let y;if(A.length>1){for(let _=0,R=b.length;_<R;_++){const P=b[_];E.addGroup(P.groupStart,P.groupCount,_)}T?y=new We(E,A):w?y=new Xe(E,A):y=new ve(E,A)}else T?y=new We(E,A[0]):w?y=new Xe(E,A[0]):y=new ve(E,A[0]);y.name=f.name,l.add(y)}else if(n.vertices.length>0){const u=new ke({size:1,sizeAttenuation:!1}),d=new we;d.setAttribute("position",new te(n.vertices,3)),n.colors.length>0&&n.colors[0]!==void 0&&(d.setAttribute("color",new te(n.colors,3)),u.vertexColors=!0);const f=new Xe(d,u);l.add(f)}return l}}class ci extends ln{constructor(t){super(t)}parse(t,n){const s=new Uint32Array(t,0,13),i={buffer:t,header:s,loadMipmaps:n};if(s[0]===55727696)return li(i);if(s[11]===559044176)return ui(i);console.error("THREE.PVRLoader: Unknown PVR format.")}}function li(o){const t=o.header;let n,e;const s=t[12],i=t[2],r=t[6],a=t[7],c=t[10],l=t[11];switch(i){case 0:n=2,e=pn;break;case 1:n=2,e=dn;break;case 2:n=4,e=fn;break;case 3:n=4,e=hn;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",i)}return o.dataPtr=52+s,o.bpp=n,o.format=e,o.width=a,o.height=r,o.numSurfaces=c,o.numMipmaps=l,o.isCubemap=c===6,bn(o)}function ui(o){const t=o.header,n=t[0],e=t[1],s=t[2],i=t[3],r=t[4],a=t[10],c=t[12],l=255,h=24,u=25,d=r&l;let f,m;const b=a>0;return d===u?(m=b?hn:fn,f=4):d===h?(m=b?dn:pn,f=2):console.error("THREE.PVRLoader: Unknown PVR format:",d),o.dataPtr=n,o.bpp=f,o.format=m,o.width=s,o.height=e,o.numSurfaces=c,o.numMipmaps=i+1,o.isCubemap=c===6,bn(o)}function bn(o){const t={mipmaps:[],width:o.width,height:o.height,format:o.format,mipmapCount:o.numMipmaps,isCubemap:o.isCubemap},n=o.buffer;let e=o.dataPtr,s=0,i=0,r=0,a=0,c=0,l=0;const h=o.bpp,u=o.numSurfaces;h===2?(r=8,a=4):(r=4,a=4),i=r*a*h/8,t.mipmaps.length=o.numMipmaps*u;let d=0;for(;d<o.numMipmaps;){const f=o.width>>d,m=o.height>>d;c=f/r,l=m/a,c<2&&(c=2),l<2&&(l=2),s=c*l*i;for(let b=0;b<u;b++){const w={data:new Uint8Array(n,e,s),width:f,height:m};t.mipmaps[b*o.numMipmaps+d]=w,e+=s}d++}return t}const Zt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Qe{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const hi=new xt(-1,1,1,-1,0,1),St=new we;St.setAttribute("position",new te([-1,3,0,-1,-1,0,3,-1,0],3));St.setAttribute("uv",new te([0,2,0,0,2,0],2));class Tn{constructor(t){this._mesh=new ve(St,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,hi)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}}class Qt extends Qe{constructor(t,n){super();this.textureID=n!==void 0?n:"tDiffuse",t instanceof Ze?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=pt.clone(t.uniforms),this.material=new Ze({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new Tn(this.material)}render(t,n,e){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=e.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}}class $t extends Qe{constructor(t,n){super();this.scene=t,this.camera=n,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(t,n,e){const s=t.getContext(),i=t.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let r,a;this.inverse?(r=0,a=1):(r=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),i.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(n),this.clear&&t.clear(),t.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(s.EQUAL,1,4294967295),i.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),i.buffers.stencil.setLocked(!0)}}class fi extends Qe{constructor(){super();this.needsSwap=!1}render(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}}class zi{constructor(t,n){if(this.renderer=t,n===void 0){const e=t.getSize(new I);this._pixelRatio=t.getPixelRatio(),this._width=e.width,this._height=e.height,n=new mt(this._width*this._pixelRatio,this._height*this._pixelRatio),n.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Zt===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Qt===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Qt(Zt),this.clock=new as}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(t,n){this.passes.splice(n,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(t){const n=this.passes.indexOf(t);n!==-1&&this.passes.splice(n,1)}isLastEnabledPass(t){for(let n=t+1;n<this.passes.length;n++)if(this.passes[n].enabled)return!1;return!0}render(t){t===void 0&&(t=this.clock.getDelta());const n=this.renderer.getRenderTarget();let e=!1;for(let s=0,i=this.passes.length;s<i;s++){const r=this.passes[s];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),r.render(this.renderer,this.writeBuffer,this.readBuffer,t,e),r.needsSwap){if(e){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}$t!==void 0&&(r instanceof $t?e=!0:r instanceof fi&&(e=!1))}}this.renderer.setRenderTarget(n)}reset(t){if(t===void 0){const n=this.renderer.getSize(new I);this._pixelRatio=this.renderer.getPixelRatio(),this._width=n.width,this._height=n.height,t=this.renderTarget1.clone(),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(t,n){this._width=t,this._height=n;const e=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(e,s),this.renderTarget2.setSize(e,s);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(e,s)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}}new xt(-1,1,1,-1,0,1);const wn=new we;wn.setAttribute("position",new te([-1,3,0,-1,-1,0,3,-1,0],3));wn.setAttribute("uv",new te([0,2,0,0,2,0],2));const Xi={uniforms:{tDiffuse:{value:null},tSize:{value:new I(256,256)},center:{value:new I(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec2 center;
		uniform float angle;
		uniform float scale;
		uniform vec2 tSize;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		float pattern() {

			float s = sin( angle ), c = cos( angle );

			vec2 tex = vUv * tSize - center;
			vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;

			return ( sin( point.x ) * sin( point.y ) ) * 4.0;

		}

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );

			float average = ( color.r + color.g + color.b ) / 3.0;

			gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );

		}`},ut={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new I(.001953125,0)},cKernel:{value:[]}},vertexShader:`

		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float cKernel[ KERNEL_SIZE_INT ];

		uniform sampler2D tDiffuse;
		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vec2 imageCoord = vUv;
			vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );

			for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {

				sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];
				imageCoord += uImageIncrement;

			}

			gl_FragColor = sum;

		}`,buildKernel:function(o){let n=2*Math.ceil(o*3)+1;n>25&&(n=25);const e=(n-1)*.5,s=new Array(n);let i=0;for(let r=0;r<n;++r)s[r]=di(r-e,o),i+=s[r];for(let r=0;r<n;++r)s[r]/=i;return s}};function di(o,t){return Math.exp(-(o*o)/(2*t*t))}class Le extends Qe{constructor(t=1,n=25,e=4,s=256){super();this.renderTargetX=new mt(s,s),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new mt(s,s),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=pt.clone(ht.uniforms),this.combineUniforms.strength.value=t,this.materialCombine=new Ze({uniforms:this.combineUniforms,vertexShader:ht.vertexShader,fragmentShader:ht.fragmentShader,blending:cs,transparent:!0}),ut===void 0&&console.error("THREE.BloomPass relies on ConvolutionShader");const i=ut;this.convolutionUniforms=pt.clone(i.uniforms),this.convolutionUniforms.uImageIncrement.value=Le.blurX,this.convolutionUniforms.cKernel.value=ut.buildKernel(e),this.materialConvolution=new Ze({uniforms:this.convolutionUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,defines:{KERNEL_SIZE_FLOAT:n.toFixed(1),KERNEL_SIZE_INT:n.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new Tn(null)}render(t,n,e,s,i){i&&t.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=e.texture,this.convolutionUniforms.uImageIncrement.value=Le.blurX,t.setRenderTarget(this.renderTargetX),t.clear(),this.fsQuad.render(t),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=Le.blurY,t.setRenderTarget(this.renderTargetY),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,i&&t.state.buffers.stencil.setTest(!0),t.setRenderTarget(e),this.clear&&t.clear(),this.fsQuad.render(t)}}const ht={uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float strength;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = strength * texel;

		}`};Le.blurX=new I(.001953125,0);Le.blurY=new I(0,.001953125);function pi(){return Ue()}function Yi(){return{basic:new be({color:16776960}),basicWireFrame:new be({color:16776960,wireframe:!0}),physical:new ue({color:16711680}),standard:new Pe,normal:new fs({colorWrite:!0,side:_t})}}function qi(){return{dodecahedron:new hs(20)}}function mi(o){return function(t){return new ve(t,o)}}const Jt=new ls,gi=(o=0,t=0)=>new C(o/window.innerWidth*2-1,-(t/window.innerHeight)*2+1,.1);function Wi(o,t,n){const{clientX:e,clientY:s}=o instanceof MouseEvent?o:o.touches[0],i=gi(e,s);return Jt.setFromCamera(i,t),Jt.intersectObjects(n)}const bi={texture:rn,dds:ti,pvr:ci},en=new Map;async function Ti(o,t,n="texture"){const e=new bi[n],s=o.join("-"),i=en.get(s);if(i)return i;const r=await Promise.all(o.map(a=>new Promise(c=>{e.load(`${t}${a}`,l=>{c(l)},void 0,()=>c(null))})));return en.set(s,r),r}function Zi(o){const t=new Map;async function n(e,s="texture",i="map"){let r=t.get(e.join("-"));if(r)return r;const[a,c]=await Ti(e,o,s),l={map:a,color:16777215,roughness:.01,metalness:0};return i!=="map"&&(l[i]=c),r=new Pe(l),t.set(e.join("-"),r),r}return n}const Qi=()=>{const o=mi(new un({color:16777215,side:_t}))(new ds(100,100));return o.rotation.x=-Math.PI/2,o.receiveShadow=!0,o.position.set(0,-5,0),o},$i=()=>{const o=new tn(16777215);return o.position.set(-10,30,40),o.shadow.mapSize.width=2048,o.shadow.mapSize.height=2048,o.shadow.camera.fov=15,o.castShadow=!0,o.decay=2,o.penumbra=.05,o.name="spot light",o},Ji=async o=>{const t=new ai;return new Promise(n=>{t.load(o,e=>{n(e)},void 0,()=>n(null))})},wi=()=>{const o=new us,t=["right.png","left.png","top.png","bottom.png","front.png","back.png"],n=new Map;return function(s){let i=n.get(s);return i||(i=o.setPath(`/three/textures/cubeMap/${s}/`).load(t),i.encoding=ce,n.set(s,i),i)}},eo=wi(),to=()=>{const o=new ps(256);o.texture.type=ms;const t=new gs(10,100,o),n=new Pe({envMap:o.texture,roughness:.05,metalness:1});return{cube:new ve(new bs(15,8),n),cubeCamera:t}};var je={Linear:{None:function(o){return o}},Quadratic:{In:function(o){return o*o},Out:function(o){return o*(2-o)},InOut:function(o){return(o*=2)<1?.5*o*o:-.5*(--o*(o-2)-1)}},Cubic:{In:function(o){return o*o*o},Out:function(o){return--o*o*o+1},InOut:function(o){return(o*=2)<1?.5*o*o*o:.5*((o-=2)*o*o+2)}},Quartic:{In:function(o){return o*o*o*o},Out:function(o){return 1- --o*o*o*o},InOut:function(o){return(o*=2)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2)}},Quintic:{In:function(o){return o*o*o*o*o},Out:function(o){return--o*o*o*o*o+1},InOut:function(o){return(o*=2)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2)}},Sinusoidal:{In:function(o){return 1-Math.cos(o*Math.PI/2)},Out:function(o){return Math.sin(o*Math.PI/2)},InOut:function(o){return .5*(1-Math.cos(Math.PI*o))}},Exponential:{In:function(o){return o===0?0:Math.pow(1024,o-1)},Out:function(o){return o===1?1:1-Math.pow(2,-10*o)},InOut:function(o){return o===0?0:o===1?1:(o*=2)<1?.5*Math.pow(1024,o-1):.5*(-Math.pow(2,-10*(o-1))+2)}},Circular:{In:function(o){return 1-Math.sqrt(1-o*o)},Out:function(o){return Math.sqrt(1- --o*o)},InOut:function(o){return(o*=2)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1)}},Elastic:{In:function(o){return o===0?0:o===1?1:-Math.pow(2,10*(o-1))*Math.sin((o-1.1)*5*Math.PI)},Out:function(o){return o===0?0:o===1?1:Math.pow(2,-10*o)*Math.sin((o-.1)*5*Math.PI)+1},InOut:function(o){return o===0?0:o===1?1:(o*=2,o<1?-.5*Math.pow(2,10*(o-1))*Math.sin((o-1.1)*5*Math.PI):.5*Math.pow(2,-10*(o-1))*Math.sin((o-1.1)*5*Math.PI)+1)}},Back:{In:function(o){var t=1.70158;return o*o*((t+1)*o-t)},Out:function(o){var t=1.70158;return--o*o*((t+1)*o+t)+1},InOut:function(o){var t=2.5949095;return(o*=2)<1?.5*(o*o*((t+1)*o-t)):.5*((o-=2)*o*((t+1)*o+t)+2)}},Bounce:{In:function(o){return 1-je.Bounce.Out(1-o)},Out:function(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},InOut:function(o){return o<.5?je.Bounce.In(o*2)*.5:je.Bounce.Out(o*2-1)*.5+.5}}},De;typeof self=="undefined"&&typeof process!="undefined"&&process.hrtime?De=function(){var o=process.hrtime();return o[0]*1e3+o[1]/1e6}:typeof self!="undefined"&&self.performance!==void 0&&self.performance.now!==void 0?De=self.performance.now.bind(self.performance):Date.now!==void 0?De=Date.now:De=function(){return new Date().getTime()};var ge=De,yn=function(){function o(){this._tweens={},this._tweensAddedDuringUpdate={}}return o.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(n){return t._tweens[n]})},o.prototype.removeAll=function(){this._tweens={}},o.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},o.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},o.prototype.update=function(t,n){t===void 0&&(t=ge()),n===void 0&&(n=!1);var e=Object.keys(this._tweens);if(e.length===0)return!1;for(;e.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<e.length;s++){var i=this._tweens[e[s]],r=!n;i&&i.update(t,r)===!1&&!n&&delete this._tweens[e[s]]}e=Object.keys(this._tweensAddedDuringUpdate)}return!0},o}(),Re={Linear:function(o,t){var n=o.length-1,e=n*t,s=Math.floor(e),i=Re.Utils.Linear;return t<0?i(o[0],o[1],e):t>1?i(o[n],o[n-1],n-e):i(o[s],o[s+1>n?n:s+1],e-s)},Bezier:function(o,t){for(var n=0,e=o.length-1,s=Math.pow,i=Re.Utils.Bernstein,r=0;r<=e;r++)n+=s(1-t,e-r)*s(t,r)*o[r]*i(e,r);return n},CatmullRom:function(o,t){var n=o.length-1,e=n*t,s=Math.floor(e),i=Re.Utils.CatmullRom;return o[0]===o[n]?(t<0&&(s=Math.floor(e=n*(1+t))),i(o[(s-1+n)%n],o[s],o[(s+1)%n],o[(s+2)%n],e-s)):t<0?o[0]-(i(o[0],o[0],o[1],o[1],-e)-o[0]):t>1?o[n]-(i(o[n],o[n],o[n-1],o[n-1],e-n)-o[n]):i(o[s?s-1:0],o[s],o[n<s+1?n:s+1],o[n<s+2?n:s+2],e-s)},Utils:{Linear:function(o,t,n){return(t-o)*n+o},Bernstein:function(o,t){var n=Re.Utils.Factorial;return n(o)/n(t)/n(o-t)},Factorial:function(){var o=[1];return function(t){var n=1;if(o[t])return o[t];for(var e=t;e>1;e--)n*=e;return o[t]=n,n}}(),CatmullRom:function(o,t,n,e,s){var i=(n-o)*.5,r=(e-t)*.5,a=s*s,c=s*a;return(2*t-2*n+i+r)*c+(-3*t+3*n-2*i-r)*a+i*s+t}}},At=function(){function o(){}return o.nextId=function(){return o._nextId++},o._nextId=0,o}(),En=new yn,yi=function(){function o(t,n){n===void 0&&(n=En),this._object=t,this._group=n,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=je.Linear.None,this._interpolationFunction=Re.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=At.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return o.prototype.getId=function(){return this._id},o.prototype.isPlaying=function(){return this._isPlaying},o.prototype.isPaused=function(){return this._isPaused},o.prototype.to=function(t,n){return this._valuesEnd=Object.create(t),n!==void 0&&(this._duration=n),this},o.prototype.duration=function(t){return this._duration=t,this},o.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t!==void 0?typeof t=="string"?ge()+parseFloat(t):t:ge(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},o.prototype._setupProperties=function(t,n,e,s){for(var i in e){var r=t[i],a=Array.isArray(r),c=a?"array":typeof r,l=!a&&Array.isArray(e[i]);if(!(c==="undefined"||c==="function")){if(l){var h=e[i];if(h.length===0)continue;h=h.map(this._handleRelativeValue.bind(this,r)),e[i]=[r].concat(h)}if((c==="object"||a)&&r&&!l){n[i]=a?[]:{};for(var u in r)n[i][u]=r[u];s[i]=a?[]:{},this._setupProperties(r,n[i],e[i],s[i])}else typeof n[i]=="undefined"&&(n[i]=r),a||(n[i]*=1),l?s[i]=e[i].slice().reverse():s[i]=n[i]||0}}},o.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},o.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},o.prototype.pause=function(t){return t===void 0&&(t=ge()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},o.prototype.resume=function(t){return t===void 0&&(t=ge()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},o.prototype.stopChainedTweens=function(){for(var t=0,n=this._chainedTweens.length;t<n;t++)this._chainedTweens[t].stop();return this},o.prototype.group=function(t){return this._group=t,this},o.prototype.delay=function(t){return this._delayTime=t,this},o.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},o.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},o.prototype.yoyo=function(t){return this._yoyo=t,this},o.prototype.easing=function(t){return this._easingFunction=t,this},o.prototype.interpolation=function(t){return this._interpolationFunction=t,this},o.prototype.chain=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._chainedTweens=t,this},o.prototype.onStart=function(t){return this._onStartCallback=t,this},o.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},o.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},o.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},o.prototype.onStop=function(t){return this._onStopCallback=t,this},o.prototype.update=function(t,n){if(t===void 0&&(t=ge()),n===void 0&&(n=!0),this._isPaused)return!0;var e,s,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>i)return!1;n&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),s=(t-this._startTime)/this._duration,s=this._duration===0||s>1?1:s;var r=this._easingFunction(s);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,s),s===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(e in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[e]=="string"&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo&&this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,c=this._chainedTweens.length;a<c;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},o.prototype._updateProperties=function(t,n,e,s){for(var i in e)if(n[i]!==void 0){var r=n[i]||0,a=e[i],c=Array.isArray(t[i]),l=Array.isArray(a),h=!c&&l;h?t[i]=this._interpolationFunction(a,s):typeof a=="object"&&a?this._updateProperties(t[i],r,a,s):(a=this._handleRelativeValue(r,a),typeof a=="number"&&(t[i]=r+(a-r)*s))}},o.prototype._handleRelativeValue=function(t,n){return typeof n!="string"?n:n.charAt(0)==="+"||n.charAt(0)==="-"?t+parseFloat(n):parseFloat(n)},o.prototype._swapEndStartRepeatValues=function(t){var n=this._valuesStartRepeat[t],e=this._valuesEnd[t];typeof e=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(e):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=n},o}(),Ei="18.6.4",_i=At.nextId,ne=En,xi=ne.getAll.bind(ne),Mi=ne.removeAll.bind(ne),Si=ne.add.bind(ne),Ai=ne.remove.bind(ne),Ri=ne.update.bind(ne),wt={Easing:je,Group:yn,Interpolation:Re,now:ge,Sequence:At,nextId:_i,Tween:yi,VERSION:Ei,getAll:xi,removeAll:Mi,add:Si,remove:Ai,update:Ri};function no(o,t){if(t.length===0)return o;const n=e=>{if(t.length===0)return()=>!0;const s=t.indexOf(e);return t.splice(s,1).length===0};return o.filter(n)}function Li(){let o=0;return function t(n){return o=requestAnimationFrame(t),wt.update(n),()=>{cancelAnimationFrame(o)}}}function so(o,t,n=()=>!1,e=1e3,s){const i=Li()(0),r=new wt.Tween(o);return r.to(t,e).easing(wt.Easing.Quadratic.Out).onUpdate(n).onComplete(()=>{i(),s==null||s()}).start(),r}function vi(o,t=50){let n;return function(){clearTimeout(n),n=setTimeout(()=>o(),t)}}const io=(o=40)=>(Math.random()>.5?-1:1)*Math.random()*o,{AmbientLight:Pi,Fog:oo,FogExp2:ro,Mesh:_n,MeshLambertMaterial:Ci,PerspectiveCamera:Ii,PlaneGeometry:Oi,Scene:ki,SpotLight:Di,Vector3:Ni,WebGLRenderer:Fi}=ws;function ao(o,t){const n=new Fe;for(let s=0,i=t.length;s<i;s++){const r=new _n(o,t[s]);n.add(r)}const e=new We(new ys(o));return e.material.color.set(16711680),n.add(e),n}function co(o=[]){const t=o.map(e=>new C(...e));return new we().setFromPoints(t)}function Ui(o,t){const n=new Es(o,t);return n.target.set(0,.5,0),n.update(),n.enablePan=!1,n.enableDamping=!0,n}function lo(o){const t=new ki,n=new Ii(45,window.innerWidth/window.innerHeight,.1,500);n.up.set(0,1,0),n.position.set(0,0,60),n.lookAt(new Ni(0,0,0));const e=new Fi({antialias:!0});e.render(t,n),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(new Y(3355443)),e.shadowMap.enabled=!0,e.outputEncoding=ce;let s=0;function i(){const _=[];function R(L){return _.push(L),()=>P(L)}function P(L){const D=_.findIndex(L);_.splice(D,1)}function F(){return _}return{getEffects:F,addEffects:R,removeEffect:P}}const r=i();function a(_){t.background=_}function c(){return t.background}function l(){const _=new Di(16777215,1.2,100,60);_.position.set(10,30,28),_.castShadow=!0,_.receiveShadow=!0,_.shadow.blurSamples=10,t.add(new Ts(_)),t.add(_)}function h(){const _=new Oi(60,40,1,1),R=new Ci({color:16777215}),P=new _n(_,R);P.receiveShadow=!0;const F=new Pi(6316040);t.add(P),t.add(F)}function u(){e.render(t,n),r.getEffects().forEach(_=>_())}function d(){u(),s=window.requestAnimationFrame(d)}function f(){window.cancelAnimationFrame(s)}function m(_){t.add(_)}function b(){const{innerHeight:_,innerWidth:R}=window;n.aspect=R/_,e.setSize(R,_),n.updateProjectionMatrix(),u()}function T(){const _=Ui(n,e.domElement);return r.addEffects(_.update.bind(_)),_}function w(){var R;const _=pi();return r.addEffects(_.update.bind(_)),(R=document.getElementById("stats"))==null||R.appendChild(_.dom),_}const x=T();function E(){var _;(_=document.getElementById(o||"three"))==null||_.appendChild(e.domElement),w(),window.requestAnimationFrame(u)}function A(){return e}function y(){return t}return{render:u,setBackground:a,getBackground:c,addSpotLight:l,addPlane:h,add:m,getRenderer:A,getScene:y,resize:vi(b),loopRender:d,stopLoopRender:f,renderEffectStore:r,mount:E,initOrbit:T,orbit:x,camera:n,dom:e.domElement}}export{Le as B,Zt as C,Ki as D,zi as E,Hi as F,Vi as G,Es as O,Bi as P,Ue as S,Gi as T,co as a,Yi as b,ao as c,mi as d,no as e,Wi as f,qi as g,io as h,Ti as i,to as j,Qi as k,Ji as l,$i as m,eo as n,Zi as o,Qe as p,Tn as q,Xi as r,Qt as s,so as t,lo as u};
